---
title: "Métodos gráficos para resumir la información"
subtitle: "Estadística Descriptiva"
author: "Cristian Santa | Alejandro Estrada"
institute: "Escuela de Nutrición y Dietética - UdeA"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    lib_dir: github
    nature:
      ratio: '16:9'
      highlightStyle: arta
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = FALSE,fig.align = "center",warning = F,message = F,
                      dpi=120,fig.width = 7,fig.height = 6)
options(htmltools.dir.version = FALSE,
        htmltools.preserve.rw =FALSE)
xaringanExtra::use_panelset()
require(ggalluvial)
require(aplore3)
require(ggplot2)
require(plotly)
require(widgetframe)
require(dplyr)
layout_ggplotly <- function(gg, x = -0.1, y = -0.08){
  # The 1 and 2 goes into the list that contains the options for the x and y axis labels respectively
  gg[['x']][['layout']][['annotations']][[1]][['y']] <- x
  gg[['x']][['layout']][['annotations']][[2]][['x']] <- y
  gg
}
```

# Introducción

<br>
En la etapa de diseño de la investigación se establece la identificación de variables, la estrategia de recolección de datos de acuerdo al diseño de estudio, el plan de captura y estructuración de la información y finalmente se establece el plan de análisis estadístico.

La primera parte de plan de análisis siempre necesita de la organización y presentación de los resultados, es decir, todo lo correspondiente al análisis descriptivo de los datos. Para esto, se cuenta con una colección de métodos de presentación de información: gráficos, tablas y medidas de resumen. Dado el tipo de variable y sus divisiones corresponde un conjunto de gráficos, tablas y medidas de resumen.

---
# Introducción

## Elementos de un gráfico

Para la presentación de la información a través de gráficos, tenga en cuenta que las recomendaciones mínimas para la construcción de un buen gráfico:

--

- Facilidad para comparar e identificar comportamiento de los datos

--

- Lenguaje preciso y claro de tal manera que se eviten confusiones sobre las características de los datos mostrados

--

- Evitar gráficas donde el gran número de categorías, indicadores o variables dificulten su interpretación

--

- Distinción clara de las categorías o rótulos del gráfico

--

- Notación de cifras y de decimales claras

--

- Evitar el uso de abreviaturas

--

- Las siglas/acrónimos deben de ir en mayúsculas y sin puntos intermedios

--

- Aclarar la escala de los ejes

---
# Introducción

Los errores comunes que se presentan en los gráficos técnicos son:

--

- Falta de títulos, convenciones y etiquetas

--

- Falta de escala en los ejes

--

- Congestionamiento o exceso de información

--

- Escasez de datos

--

- Mala calidad de la impresión

--

- Incluir un eje adicional sin sentido para dar efectos 3D

---
```{r,fig.height=5,fig.width=5,dpi=100}
oldpar <- par()
par(mar=c(6,6,5,5))
plot(0,ylab="",xlab="",axes = F,col=0)
box()
title(main = "Título del Gráfico\n",cex.main=1.5,col.main="forestgreen")
title(main = "\n(Qué, Dónde, Cuándo)",cex.main=1)
title(ylab="Título del Eje\n",cex.lab=1,col.lab="forestgreen")
title(ylab="\n(Descripción, Categorías)",cex.lab=0.8)
title(xlab="Título del Eje\n",cex.lab=1,col.lab="forestgreen")
title(xlab="\n(Descripción, Categorías)",cex.lab=0.8)
title(sub="Notas al pie, Fuentes",col.sub=2)
text(1,0,labels = "Contenido del\ngráfico",cex = 2.5,col="forestgreen")
```
---
class: inverse, center, middle

# Gráficos para Variables Cualitativas

---
# Gráficos para Variables Cualitativas

En la sección anterior se explicó las clasificaciones de las variables, para el caso de las variables cualitativas se agrupan en **Nominales** y **Ordinales**.

La construcción de gráficos adecuados para este tipo de variable se basan en la representación de los conteos, si se tiene más de una variable es posible mostrar su relación.

>Para los siguientes ejemplos son resultados del software estadístico `R-project` y se utilizará la base de datos de NHANES del paquete de `aplore3`.

```{r,eval=FALSE,echo=TRUE}
# Se requieren de los siguientes paquetes (instalar una sola vez)
pkg <- c("ggplot2","dplyr","aplore3","agricolae","e1017")
install.packages(pkg)

# Una vez instalados se cargan los paquetes
sapply(pkg, require, character.only=T)

# Para ver los datos de NHANES
nhanes
```

---
# Gráficos para Variables Cualitativas
### Gráfico de barras

Este gráfico se caracteriza por identificar las categorías o niveles de una variable cualitativa a relacionando la frecuencia de ocurrencia (**frecuencia absoluta**) a través de barras *separadas*. Para que el gráfico cobre sentido e interpretación rápida se recomienda que cada barra tenga un color distinto.

.panelset[
.panel[.panel-name[Vertical]
```{r, echo=FALSE}
p <- nhanes %>% 
  ggplot(aes(x=marstat,fill=marstat))+
  geom_bar()+
  geom_text(stat = "count",aes(label=..count..),vjust=-1)+
  theme_bw()+xlab("\nEstado Civil\n")+
  ylab("Frecuencia")+
  ylim(c(0,3500))+
  ggtitle("Estado Civil de los norteamericanos encuestados")+
  theme(legend.position = "none")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 300)
```
]
.panel[.panel-name[Horizontal]
```{r, echo=FALSE}
p <- nhanes %>% 
  ggplot(aes(x=marstat,fill=marstat))+
  geom_bar()+
  geom_text(stat = "count",aes(label=..count..),hjust=-1)+
  theme_bw()+xlab("\nEstado Civil\n")+
  ylab("Frecuencia")+
  ylim(c(0,3500))+
  ggtitle("Estado Civil de los norteamericanos encuestados")+
  theme(legend.position = "none")+
  coord_flip()
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 300)
```
]
]

---
# Gráfico de Barras
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# Construya la tabla de frecuencias con la función "table"
tabla <- table(nhanes$marstat, useNA = "ifany")

# La función "barplot" construye el gráfico de barras de una tabla
# en la función se ingresan los argumentos para dar el toque estético
b1 <- barplot(tabviv,las=1,main = "Estado Civil de los norteamericanos encuestados",
             ylab="Frecuencia",xlab="Estado Civil",col=2:8,
             ylim=c(0,3500),cex.names = 0.8,cex.axis = 0.8)

# Para añadir las frecuencias a las barras está este truco
text(b1,tabla+1,labels = tabla)

# Consulta la ayuda de las funciones
?barplot
?table
?text
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
# El operador '%>%' sirve para encadenar funciones
nhanes %>% 
  # Activar el gráfico
  ggplot(aes(x=marstat,fill=marstat))+
  # Añadir las barras
  geom_bar()+
  # Poner texto a las barras
  geom_text(stat = "count",aes(label=..count..),vjust=-1)+
  # Fondo blanco
  theme_bw()+
  # Títulos de los ejes
  xlab("Estado Civil")+ylab("Frecuencia")+
  # Límites para el eje Y
  ylim(c(0,3500))+
  # Título principal
  ggtitle("Estado Civil de los norteamericanos encuestados")+
  # (opcional) quitar la leyenda de las categorías
  theme(legend.position = "none")
```
]
]

---
# Gráfico de Barras
Este gráfico también es útil cuando se tiene dos variables categóricas, siempre y cuando los niveles de dicha variable sean pocas para no saturar el gráfico.

.panelset[
.panel[.panel-name[Apilado]

```{r,echo=FALSE}
p <- nhanes %>% 
  ggplot(aes(x=marstat,fill=gender))+
  geom_bar()+
  theme_bw()+xlab("\nEstado Civil\n")+
  ylab("Frecuencia")+labs(fill="Sexo")+
  ylim(c(0,3500))+
  ggtitle("Estado Civil de los norteamericanos encuestados según su sexo")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```

]
.panel[.panel-name[Separado]

```{r,echo=FALSE}
p <- nhanes %>% 
  ggplot(aes(x=marstat,fill=gender))+
  geom_bar(position = "dodge")+
  theme_bw()+xlab("\nEstado Civil\n")+
  ylab("Frecuencia")+labs(fill="Sexo")+
  ylim(c(0,2000))+
  ggtitle("Estado Civil de los norteamericanos encuestados según su sexo")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```

]
]

---
# Gráficos para Variables Cualitativas
## Gráfico de Torta

El gráfico de torta muestra por secciones de un círculo las proporciones o frecuencias de las categorías de una variable cualitativa

.pull-left[
```{r,fig.width=5,fig.height=5,dpi=100}
nhanes %>% group_by(marstat) %>%
    summarise(n=n()) %>%
  plot_ly(labels=~marstat,
          values=~n,type="pie",
          showlegend = FALSE) %>%
  layout(title = 'Estado Civil de los norteamericanos encuestados',
         autosize = F, width = 600, height = 400) %>%
  config(displayModeBar = F)
```
]
.pull-right[

> Este gráfico tiene la dificultad en términos de interpretación, ya que la disposición circular no permite hacer distinciones sencillas sobre la proporcionalidad a menos que la categorías sean claramente dispares

]
---
# Gráfico de Torta

.panelset[
.panel[.panel-name[Torta]
```{r,fig.width=5,fig.height=5,dpi=100}
pie(table(c(rep("A",28),rep("B",25),rep("C",23))),
    main = "¿Las frecuencias de las\nCategorías son distintas?")
```
]
.panel[.panel-name[Barras]
```{r,fig.width=5,fig.height=5,dpi=100}
barplot(table(c(rep("A",28),rep("B",25),rep("C",23))),las=1,
        col=c("white", "lightblue", "mistyrose"),ylim=c(0,30),
        main = "En efecto, sí")
```
]
]
---
# Gráfico de Torta

Una opción para reducir la limitación de proporcionalidad en este gráfico es utilizar etiquetas para indicar las proporciones o frecuencias de cada categoría, o bien usar un *gráfico de dona*.

<center>
```{r}
nhanes %>% group_by(marstat) %>%
    summarise(n=n()) %>%
  plot_ly() %>%
  add_pie(labels = ~marstat,values = ~n, name="Pie",
          domain = list(row = 0, column = 0)) %>%
  add_pie(labels = ~marstat,values = ~n,hole=0.5, name="Donut",
          domain = list(row = 0, column = 1)) %>%
  layout(title = "", showlegend = F,
         grid=list(rows=1, columns=2),
         autosize = F, height = 400) %>%
  config(displayModeBar = F)
```
</center>
---
# Gráfico de Torta
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# Construya la tabla de frecuencias con la función "table"
tabla <- table(nhanes$marstat, useNA = "ifany")

# La función "pie" construye el gráfico de tortas de una tabla
# En la función se ingresan los argumentos para dar el toque estético
# En el argumento labels, se puede usar la función "paste" para pegar
# la categoría ("names") con la frecuencia ("tabdep")
pie(tabla,col = rainbow(7),
    labels = paste(names(tabla),tabviv,sep = "\n"))

# Consulta la ayuda de las funciones
?pie
?paste
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
# El operador '%>%' sirve para encadenar funciones
nhanes %>% 
  # Agrupar la base de datos por la variable de interés
  group_by(marstat) %>%
  # Calcular las frecuencias
  summarise(n = n()) %>%
  # Activar el gráfico
  ggplot(aes(x="",y=n,fill=marstat))+
  # Añadir las barras
  geom_bar(stat = "identity",col="black")+
  # Transformar las barras en segmentos
  coord_polar("y",start=0)+
  # Fondo blanco
  theme_void()+
  # Título principal
  ggtitle("Estado Civil de los norteamericanos encuestados")+
  # (opcional) quitar la leyenda de las categorías
  theme(legend.position = "none")
```
]
]
---
# Gráficos para Variables Cualitativas

## Diagrama de puntos
Este gráfico también es similar al gráfico de barras, sirve para presentar las frecuencias absolutas o relativas de una variable cualitativa, y muestra un punto que representa el conteo del total de observaciones que hay para cada variable.

.panelset[
.panel[.panel-name[Una variable]
```{r,warning=FALSE,fig.align='center',fig.height=3}
nhanes %>%
  select(marstat) %>%
  table %>% 
  dotchart(pch=19,xlab = "Frecuencia",cex = 0.8,
         main = "Estado Civil de los norteamericanos encuestados")
```
]
.panel[.panel-name[Dos variables]
```{r,warning=FALSE,fig.align='center',fig.height=3}
nhanes %>%
  select(marstat,gender) %>%
  table %>% as.matrix %>%
  dotchart(pch=19,xlab = "Frecuencia",gcolor = 2,cex=0.6,
         main = "Estado Civil de los norteamericanos encuestados\nsegún el sexo")
```
]
]
---
# Diagrama de puntos
En `R` es fácil construir este gráfico con el siguiente código:

```{r,eval=FALSE,echo=TRUE}
# Construya la tabla de frecuencias con la función "table"
tabla <- table(nhanes$marstat, useNA = "ifany")

# La función "dotchart" construye el diagrama de puntos de una tabla
# En la función se ingresan los argumentos para dar el toque estético
# En el argumento pch, se pone el número que representa el símbolo a usar
dotchart(tabla,pch = 19,xlab = "Frecuencia",
         main = "Estado Civil de los norteamericanos encuestados")

# Consulta la ayuda de las funciones
?dotchart
```
---
# Gráficos para Variables Cualitativas

## Gráfico de mosaico

En muchas ocasiones se tiene más de una variable categórica y un gráfico de barras compuesto no es suficiente para exponer con precisión la información. Para este caso, el gráfico de mosaico permite relacionar más de dos variables para analizar las frecuencias entre los cruces de niveles de las variables categóricas.

```{r,echo=FALSE,warning=FALSE,message=FALSE}
require(ggmosaic)
p <- nhanes %>%
  mutate(cbmi = cut(bmi,breaks = c(-Inf,18.5,25,30,Inf),
                    right = F,
                    labels = c("Delgadez","Normalidad",
                               "Sobrepeso","Obesidad"))) %>%
  ggplot()+
  geom_mosaic(aes(x=product(marstat,cbmi),fill=marstat))+
  ggtitle("Relación entre el estado civil y la clasificación IMC")+
  labs(fill="Estado\nCivil")+
  xlab("")+ylab("")+
  theme_bw()+
  theme(legend.position = "none")
frameWidget(ggplotly(p),height = 400)
```
---
# Gráfico de mosaico
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# Construya la variable de clasificación IMC
nhanes <- nhanes %>%
  mutate(cbmi = cut(bmi,breaks = c(-Inf,18.5,25,30,Inf),right = F,
                    labels = c("Delgadez","Normalidad",
                               "Sobrepeso","Obesidad")))

# Construya la tabla de frecuencias con la función "table"
tabla2 <- table(nhanes$marstat,nhanes$cbmi)

# La función "mosaicplot" construye el gráfico de mosaico de una tabla
# En la función se ingresan los argumentos para dar el toque estético
mosaicplot(tabla2,las=1,col=terrain.colors(6),
           main = "Relación entre el estado civil y la clasificación IMC",
           cex=0.8)

# Consulta la ayuda de las funciones
?mosaicplot
?mutate
?cut
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
# Se requiere del paquete `ggmosaic`
install.packages("ggmosaic")
require(ggmosaic)

# El operador '%>%' sirve para encadenar funciones
nhanes %>% 
  # Construya la variable de clasificación IMC
  mutate(cbmi = cut(bmi,breaks = c(-Inf,18.5,25,30,Inf),right = F,
                    labels = c("Delgadez","Normalidad",
                               "Sobrepeso","Obesidad"))) %>%
  # Activar el gráfico
  ggplot()+
  # Añadir el mosaico
  geom_mosaic(aes(x=product(marstat,cbmi),fill=marstat))+
  # Fondo blanco
  theme_bw()+
  # Título principal
  ggtitle("Relación entre el estado civil y la clasificación IMC")
```
]
]
---
# Gráficos para Variables Cualitativas
### Diagrama de *Sankey* (gráfico alluvial)

Este gráfico relaciona las transferencia de frecuencias entre los niveles de varias variables categóricas, también se conoce como **Alluvial plot**. Lleva el nombre de *Sankey* por el capitán irlandés Matthew Henry Phineas Riall Sankey quién utilizó este diagrama en 1898 en una publicación sobre la eficiencia energética de la máquina de vapor. El gráfico más famoso de este tipo, y catalogado como el mejor gráfico de la historia, es el diagrama de la invasión napoleónica a Rusia.

<center>
<img src="Minard.png" alt="Invasión Napoleónica a Ruisa" width="70%"/>
</center>

---
# Diagrama de *Sankey* (gráfico alluvial)

```{r,fig.align='center',fig.height=5,fig.width=9,dpi=120}
nhanes %>%
  mutate(cbmi = cut(bmi,breaks = c(-Inf,18.5,25,30,Inf),right = F,
                    labels = c("Delgadez","Normalidad",
                               "Sobrepeso","Obesidad"))) %>%
  select(gender,cbmi,marstat) %>%
  table %>% as.data.frame.table %>%
  ggplot(aes(y=Freq,axis1=gender,axis2=cbmi,axis3=marstat))+
  geom_alluvium(aes(fill=marstat),width=1/12)+
  geom_stratum(width = 1/8,color="black",fill="gray")+
  geom_label(stat = "stratum", aes(label = after_stat(stratum)),size=2)+
  scale_x_discrete(limits = c("Género", "IMC", "Estado Civil"),
                   expand = c(.05, .05)) +
  theme_bw()+labs(fill="Estado Civil")+ylab("Frecuencia")+
  ggtitle("Relación del Estado Civil según la Clasificación IMC y el género")
```
---
# Diagrama de *Sankey* (gráfico alluvial)
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# Se requiere del paquete `alluvial`
install.packages("alluvial")
require(alluvial)

# Construya la tabla de frecuencias
datos <- as.data.frame.table(table(nhanes$gender,nhanes$cbmi,nhanes$marstat))

# La función "alluvial" construye el diagrama de Sankey
# En la función se ingresan los argumentos para dar el toque estético
alluvial(datos[,1:3],freq = datos$Freq,
         col=2:7,cex = 0.8)

# Consulta la ayuda de las funciones
?as.data.frame.table
?alluvial
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
nhanes %>% 
  # Seleccionar las variables de interés
  select(gender,cbmi,marstat) %>%
  # Construir la tabla de frecuencias
  table %>% as.data.frame.table %>%
  # Activar el gráfico
  ggplot(aes(y=Freq,axis1=gender,axis2=cbmi,axis3=marstat))+
  # Añadir el alluvial
  geom_alluvium(aes(fill=marstat),width=1/12)+
  # Configurar los estratos
  geom_stratum(width = 1/8,color="black",fill="gray")+
  # Añadir textos a los estratos
  geom_label(stat = "stratum", aes(label = after_stat(stratum)),size=2)+
  # Añadir textos a los ejes
  scale_x_discrete(limits=c("Género","IMC","Estado Civil"),expand = c(.05,.05))+
  # Fondo blanco y ejes
  theme_bw()+labs(fill="Estado Civil")+ylab("Frecuencia")+
  # Título principal
  ggtitle("Relación entre el estado civil y la clasificación IMC")
```
]
]
---
class: inverse, center, middle

# Gráficos para Variables Cuantitativas

---
# Gráficos para Variables Cuantitativas

La construcción de gráficos adecuados para este tipo de variable se basan en la representación de las frecuencias por intervalo, la densidad de probabilidad o las ubicaciones en un plano cartesiano, si se tiene más de una variable es posible mostrar su relación.

>Para los siguientes ejemplos son resultados del software estadístico `R-project` y continuaremos con la base de datos de NHANES del paquete de `aplore3`.

---
# Gráficos para Variables Cuantitativas
## Histograma

Este gráfico permite visualizar el comportamiento o distribución de una variable cuantitativa, divide la continuidad de la variable en intervalos equidistantes para visualizar las frecuencias por cada intervalo. La diferencia con el gráfico de barras, es que en el histograma las barras se encuentran pegadas unas de otras y se deben poner con el mismo color.

```{r}
p <- nhanes %>%
  ggplot(aes(x=hdl))+
  geom_histogram(col="black",fill="darkcyan")+
  ylab("Frecuencia\n")+xlab("Colesterol HDL (mg/dL)")+
  ggtitle("Colesterol HDL de los Encuestados en NHANES")+
  theme_bw()
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```

---
# Histograma
Observe que en el eje opuesto se muestra la frecuencia de ocurrencia del IMC, con este gráfico también podemos ver las frecuencias relativas o **densidades** que denotan las probabilidades de la variable aleatoria.

```{r,fig.width=6,fig.height=5,dpi=120}
p <- nhanes %>%
  ggplot(aes(x=hdl))+
  geom_histogram(aes(y=..density..),col="black",fill="gold3")+
  ylab("Densidad\n")+xlab("Colesterol HDL (mg/dL)")+
  ggtitle("Colesterol HDL de los Encuestados en NHANES")+
  theme_bw()
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```
---
# Histograma
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# La finción "hist" construye el histograma
# En los argumentos de la función se hacen los toque estéticos
# El operador "$" sirve para seleccionar una variable de un
# data.frame
hist(datos$mass,col="darkcyan",las=1,cex.axis=0.7,
     main="Colesterol HDL de los Encuestados en NHANES",
     ylab="Frecuencia",xlab="Colesterol HDL (mg/dL)")

# Consulta la ayuda
?hist
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
nhanes %>% 
  # Activar el gráfico
  ggplot(aes(x=hdl))+
  # Añadir el histograma
  geom_histogram(col="black",fill="darkcyan")+
  # Añadir textos a los ejes
  ylab("Frecuencia\n")+xlab("Colesterol HDL (mg/dL)")+
  # Fondo blanco y ejes
  theme_bw()+
  # Título principal
  ggtitle("Colesterol HDL de los Encuestados en NHANES")
```
]
]
---
# Gráficos para Variables Cuantitativas
## Diagrama de ojiva

Este gráfico muestra la frecuencia acumulada, sea absoluta o relativa, de una variable cuantitativa según los intervalos de clases creados en el histograma. Es muy útil para observar la tasa de crecimiento en términos de probabilidad de una variable. Para construir el gráfico de ojiva necesitamos el paquete de `agricolae` el cual se puede instalar así:

```{r,eval=F,echo=T}
install.packages("agricolae",dependencies = T)

# para cargar el paquete
require(agricolae)
```

La función de interés es `ogive.freq` y requiere de un histograma ya construido.
---
# Diagrama de ojiva

```{r,echo=FALSE}
p <- nhanes %>%
  ggplot(aes(x=hdl))+
  geom_hline(yintercept = c(0,1),col="grey50",lty=2)+
  stat_ecdf(n=15,geom = "line")+
  geom_point(stat="ecdf",n=15,size=2)+
  scale_x_continuous(n.breaks = 12)+
  scale_y_continuous(n.breaks = 10)+
  theme_bw()+
  xlab("\nColesterol HDL (mg/dL)")+
  ylab("Densidad Acumulada\n")+
  ggtitle("Comportamiento Acumulado del Colesterol HDL de los Encuestados en NHANES")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 600)
```
---
# Diagrama de ojiva
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# La finción "hist" construye el histograma
# La función "ogive.freq" contruye la ojiva
# En los argumentos de la función se hacen los toque estéticos
ogive.freq(hist(nhanes$hdl,plot = F),ylab="Densidad Acumulada",
  xlab="Colesterol HDL (mg/dL)",pch=19,
  main="Comportamiento Acumulado del Colesterol HDL\nde los Encuestados en NHANES")

# Consulta la ayuda
?ogive.freq
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
nhanes %>% 
  # Activar el gráfico
  ggplot(aes(x=hdl))+
  # Añadir la ojiva
  stat_ecdf(n=15,geom = "line")+
  # Añadir los puntos
  geom_point(stat="ecdf",n=15,size=2)+
  # Añadir textos a los ejes
  xlab("Colesterol HDL (mg/dL)")+ylab("Densidad Acumulada")+
  # Fondo blanco
  theme_bw()+
  # Título principal
  ggtitle("Comportamiento Acumulado del Colesterol HDL de los Encuestados en NHANES")
```
]
]
---
# Gráficos para Variables Cuantitativas
## Gráfico densidad acumulada empírica

Este gráfico es similar a la ojiva, pero se diferencia en que hace la evaluación de la distribución cumulada de todos los datos cuantitativos.

```{r}
p <- nhanes %>%
  ggplot(aes(x=hdl))+
  geom_hline(yintercept = c(0,1),col="grey50",lty=2)+
  stat_ecdf(geom = "line")+
  geom_point(stat="ecdf")+
  scale_x_continuous(n.breaks = 12)+
  scale_y_continuous(n.breaks = 10)+
  theme_bw()+
  xlab("Colesterol HDL (mg/dL)")+
  ylab("Densidad Acumulada\n")+
  ggtitle("Comportamiento Acumulado del Colesterol HDL de los Encuestados en NHANES")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```
---
# Gráfico densidad acumulada empírica
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# La finción "ecdf" se calcula la densidad acumulada
# La función "plot" contruye el gráfico
# En los argumentos de la función se hacen los toque estéticos
plot(ecdf(nhanes$hdl),ylab="Densidad Acumulada",
  xlab="Colesterol HDL (mg/dL)",pch=19,las=1,
  main="Comportamiento Acumulado del Colesterol HDL\nde los Encuestados en NHANES")

# Qué hace este código?
ecdf(nhanes$hdl)(55)

# Consulta la ayuda
?ecdf
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
nhanes %>% 
  # Activar el gráfico
  ggplot(aes(x=hdl))+
  # Añadir la ojiva
  stat_ecdf(geom = "line")+
  # Añadir los puntos
  geom_point(stat="ecdf")+
  # Añadir textos a los ejes
  xlab("Colesterol HDL (mg/dL)")+ylab("Densidad Acumulada")+
  # Fondo blanco
  theme_bw()+
  # Título principal
  ggtitle("Comportamiento Acumulado del Colesterol HDL\nde los Encuestados en NHANES")
```
]
]
---
# Gráficos para Variables Cuantitativas
## Gráfico de densidad

Este gráfico es una estimación de la curva característica de una variable continua, la estimación se realiza vía métodos numéricos, así que es una aproximación empírica de la distribución de probabilidad.

```{r}
p <- nhanes %>%
    ggplot(aes(x=hdl))+
    geom_density(lwd=1,col=2)+
    scale_x_continuous(n.breaks = 12)+
    scale_y_continuous(n.breaks = 12)+
    theme_bw()+
    xlab("Colesterol HDL (mg/dL)")+
    ylab("Densidad\n")+
    ggtitle("Distribución empírica del Colesterol HDL de los Encuestados en NHANES")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```
---
# Gráfico de densidad
El modelamiento de la curva comparte el mismo comportamiento del histograma, en este sentido ambos gráficos están relacionados.

```{r,fig.width=6,fig.height=5,dpi=90}
p <- nhanes %>%
    ggplot(aes(x=hdl))+
    geom_histogram(col="black",fill="darkcyan",aes(y=..density..))+
    geom_density(lwd=1,col=2)+
    scale_x_continuous(n.breaks = 12)+
    scale_y_continuous(n.breaks = 10)+
    theme_bw()+
    xlab("Colesterol HDL (mg/dL)")+
    ylab("Densidad\n")+
    ggtitle("Distribución empírica del Colesterol HDL de los Encuestados en NHANES")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 500)
```
---
# Gráfico de densidad
En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# La finción "density" estima la curva de densidad
# La función "lines" agrega la línea al histograma
# En los argumentos de la función se hacen los toque estéticos
hist(nhanes$hdl,col="darkcyan",las=1,cex.axis=0.8,
     main="Distribución empírica del Colesterol HDL\nde los Encuestados en NHANES",
     ylab="Densidad",xlab="Colesterol HDL (mg/dL)",freq = F,ylim=c(0,0.03))
lines(density(nhanes$hdl,na.rm = T),col=2,lwd=2)

# Consulta la ayuda
?density
?lines
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
nhanes %>% 
  # Activar el gráfico
  ggplot(aes(x=hdl))+
  # Añadir el gráfico de densidad
  geom_density(lwd=1,col=2)+
  # Añadir textos a los ejes
  xlab("Colesterol HDL (mg/dL)")+ylab("Densidad")+
  # Fondo blanco
  theme_bw()+
  # Título principal
  ggtitle("Distribución empírica del Colesterol HDL\nde los Encuestados en NHANES")
```
]
]
---
# Gráficos para Variables Cuantitativas
## Box-Plot

El gráfico de cajas y bigotes (*boxplot*) es un diagrama que divide una variable continua en cuartiles, es muy útil para detectar posibles *valores atípicos*.

<center>
<img src="BoxPlot.jpg" alt="boxplot" width="90%"/>
</center>

---
# Box-Plot

.pull-left[
```{r}
p <- nhanes %>%
  ggplot(aes(x=hdl))+
  geom_boxplot(fill="gold3")+
  scale_x_continuous(n.breaks = 12)+
  theme_bw()+ylim(c(-0.5,0.5))+
  xlab("Colesterol HDL (mg/dL)")+
  ggtitle("Comportamiento del Colesterol HDL de los Encuestados en NHANES")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```
]
.pull-right[
```{r}
p <- nhanes %>%
  ggplot(aes(y=hdl))+
  geom_boxplot(fill="gold3")+
  scale_y_continuous(n.breaks = 12)+
  theme_bw()+xlim(c(-0.5,0.5))+
  xlab("Colesterol HDL (mg/dL)")+
  ggtitle("Comportamiento del Colesterol HDL de los Encuestados en NHANES")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F),height = 400)
```
]
---
# Box-Plot
Este gráfico muestra por cuartiles la distribución de la variable aleatoria, en este sentido está relacionado con otros gráficos que muestran el comportamiento de los datos, como el histograma o la curva de densidad.

```{r,fig.width=6,fig.height=5,dpi=90}
nf <- graphics::layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(3,1))
par(mar=c(2.1, 4.1, 2.1, 2.1))
hist(nhanes$hdl,col="darkcyan",las=1,cex.axis=0.8,xlim = c(5,160),
     main="Comportamiento del Colesterol HDL\nde los Encuestados en NHANES",
     ylab="Densidad",xlab="Colesterol HDL (mg/dL)",freq = F,ylim=c(0,0.03))
lines(density(nhanes$hdl,na.rm = T),col=2,lwd=2)
rug(nhanes$hdl,col=2)
boxplot(nhanes$hdl,horizontal=TRUE,
        outline=TRUE,ylim=c(5,160),cex.axis=0.8,
        frame=F,col="gold2",width=10,xaxs="n",pch=20)
```
---
# Box-Plot

En `R` es fácil construir este gráfico con el siguiente código:

.panelset[
.panel[.panel-name[Básico]
```{r,eval=FALSE,echo=TRUE}
# La finción "boxplot" construye el gráfico
# El argumento "horizontal" gira el boxplot
# En los argumentos de la función se hacen los toque estéticos
boxplot(nhanes$hdl,pch=20,col="gold2",horizontal = T,
        main="Comportamiento del Colesterol HDL\nde los Encuestados en NHANES",
        xlab="Colesterol HDL (mg/dL)")

# Consulta la ayuda
?boxplot
```
]
.panel[.panel-name[ggplot2]
```{r,eval=FALSE,echo=TRUE}
nhanes %>% 
  # Activar el gráfico
  ggplot(aes(x=hdl))+
  # Añadir el box-plot
  geom_boxplot(fill="gold3")+
  # Añadir textos a los ejes
  xlab("Colesterol HDL (mg/dL)")+ylab("Densidad")+
  # Fondo blanco
  theme_bw()+
  # Título principal
  ggtitle("Distribución empírica del Colesterol HDL\nde los Encuestados en NHANES")
```
]
]
---
class: inverse, center, middle

# Gráficos Compuestos

---
# Gráficos Compuestos

Hasta ahora se han vistos casos para realizar gráficos univariados, y unos cuantos que relacionan *tablas de contingencias*. Existen varios gráficos compuestos para relacionar más de una variable, ya sean cuantitativas o cualitativas, a continuación se presentan los gráficos más usados para literatura científica con sus respectivos códigos en `R`.

Para los siguientes ejemplos se utilizará el paquete `ggplot2` para realizar gráficos más complejos, , pero fáciles de programar y el paquete `dplyr` para realizar filtros y agrupaciones de las bases de datos.

```{r,echo=T,eval=F}
install.packages(c("ggplot2","dplyr"),dependencies = T)
```

Para los siguientes ejemplos utilizaremos las bases de datos de *Diabetes en los Indígenas Pima* publicado por el Instituto Nacional de Diabetes y Enfermedades Digestivas y Renales. Esta bases de datos las encontraremos en el paquete `mlbench`, la cual instalaremos así:

```{r,eval=F,echo=T}
install.packages("mlbench",dependencies = T)

# Para cargar el paquete
require(mlbench)
datos <- get(data(PimaIndiansDiabetes2))
```

---
# Scatterplot

El **gráfico de dispersión** o *scatterplot* relaciona dos variables continuas, es útil para evaluar de manera visual la relación entre dos variables en términos de dependencia, sea creciente o decreciente.

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>% ggplot(aes(x=triceps,y=mass))+
  geom_point()+
  ggtitle("Relación del IMC de los indígenas\ncon el espesor del tríceps")+
  ylab("IMC (kg/m^2)")+
  xlab("Espesor del pliegue cutáneo del tríceps (mm)")
```
]
.pull-right[
```{r}
require(mlbench)
datos <- get(data(PimaIndiansDiabetes2))

p <- datos %>%
  ggplot(aes(x=triceps,y=mass))+
  geom_point(size=1)+
  ggtitle("Relación del IMC de los indígenas\ncon el espesor del tríceps")+
  ylab("IMC (kg/m^2)")+
  xlab("Espesor del pliegue cutáneo del tríceps (mm)")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=100)),
            height = 450)
```
]
---
# Gráficos compuestos

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>%
  ggplot(aes(x=triceps,y=mass,
             colour=diabetes))+
  geom_point()+
  ggtitle("Relación del IMC de los indígenas\ncon el espesor del tríceps según la condición de diabetes")+
  ylab("IMC (kg/m^2)")+
  xlab("Espesor del pliegue cutáneo del tríceps (mm)")
```
]
.pull-right[
```{r}
p <- datos %>%
  ggplot(aes(x=triceps,y=mass,
             colour=diabetes))+
  geom_point(size=1)+
  ggtitle("Relación del IMC de los indígenas con el espesor del\ntríceps según la condición de diabetes")+
  ylab("IMC (kg/m^2)")+labs(colour="")+
  xlab("Espesor del pliegue cutáneo del tríceps (mm)")+
  theme(legend.position = "bottom")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=100,r=80)),
            height = 500)
```
]
---
# Gráficos compuestos

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>%
  mutate(presion=ifelse(pressure<80,"Normal","Alta")) %>%
  ggplot(aes(x=triceps,y=mass,
             colour=presion))+
  geom_point()+
  ggtitle("Relación del IMC de los indígenas\ncon el espesor del tríceps según la condición de diabetes\ny presión diastólica")+
  ylab("IMC (kg/m^2)")+
  xlab("Espesor del pliegue cutáneo del tríceps (mm)")+
  facet_wrap(~diabetes)
```
]
.pull-right[
```{r}
p <- datos %>%
  mutate(presion=ifelse(pressure<80,"Normal","Alta")) %>%
  ggplot(aes(x=triceps,y=mass,
             colour=presion))+
  geom_point(size=1)+
  ggtitle("Relación del IMC de los indígenas con el espesor del\ntríceps según la condición de diabetes\ny presión diastólica")+
  ylab("IMC (kg/m^2)")+
  xlab("Espesor del pliegue cutáneo del tríceps (mm)")+
  theme(legend.position = "bottom")+labs(colour="")+
  facet_wrap(~diabetes)
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=150,l=60,b=90,r=40)) %>%
              layout_ggplotly(y=-0.05,x=-0.15),
            height = 500)
```
]
---
# Gráficos compuestos

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>%
  filter(age>=28 & age<=64) %>%
  mutate(presion=ifelse(pressure<80,"Normal","Alta")) %>%
  mutate(CIMC=cut(mass,breaks = c(10,18.5,25,30,35,Inf),
                  labels = c("Delgadez","Normalidad",
                             "Sobrepeso","Obesidad","O Extrema"))) %>%
  na.omit %>%
  ggplot(aes(x=glucose,y=insulin,colour=CIMC))+
  geom_point()+labs(colour="IMC")+
  ggtitle("Relación entre la glucosa y la insulina\nIndígenas adultos segun IMC, presion y diabetes")+
  ylab("Insulina (mu U/ml)")+
  xlab("Concentración de glucosa en plasma")+
  facet_grid(presion~diabetes)
```
]
.pull-right[
```{r}
p <- datos %>%
  filter(age>=28 & age<=64) %>%
  mutate(presion=ifelse(pressure<80,"Normal","Alta")) %>%
  mutate(CIMC=cut(mass,breaks = c(10,18.5,25,30,35,Inf),
                  labels = c("Delgadez","Normalidad",
                             "Sobrepeso","Obesidad","O Extrema"))) %>%
  na.omit %>%
  ggplot(aes(x=glucose,y=insulin,colour=CIMC))+
  geom_point(size=1)+labs(colour="")+
  ggtitle("Relación entre la glucosa y la insulina\nIndígenas adultos segun IMC, presion y diabetes")+
  ylab("Insulina (mu U/ml)")+
  xlab("Concentración de glucosa en plasma")+
  theme(legend.position = "bottom")+
  facet_grid(presion~diabetes)
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=130,l=80,b=90,r=40),
                     legend = list(orientation = "h",
                                   font=list(size=10),
                                   y=-0.25,x=0.1)) %>%
              layout_ggplotly(x=-0.15),
            height = 500)
```
]
---
# Gráficos compuestos

Los **BoxPlot** también pueden mezclar variables cualitativas y cuantitativas, ya que se puede separar por los niveles de las categorías y condicionarlas por las mediciones de la variable continua.

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>%
  ggplot(aes(y=mass,x=diabetes,fill=diabetes))+
  geom_boxplot()+
  ggtitle("IMC según la condición de diabetes")+
  ylab("IMC (kg/m^2)")+
  xlab("Diabetes")
```
]
.pull-right[
```{r}
p <- datos %>%
  ggplot(aes(y=mass,x=diabetes,fill=diabetes))+
  geom_boxplot()+
  ggtitle("IMC según la condición de diabetes")+
  theme(legend.position = "bottom")+labs(fill="")+
  ylab("IMC (kg/m^2)")+xlab("Diabetes")
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=80,r=100)),
            height = 500)
```
]
---
# Gráficos compuestos

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>%
  mutate(CIMC=cut(mass,breaks = c(10,18.5,25,30,35,Inf),
                  labels = c("Delgadez","Normalidad",
                             "Sobrepeso","Obesidad","O Extrema"))) %>%
  ggplot(aes(y=insulin,x=CIMC,fill=CIMC))+
  geom_boxplot()+
  coord_flip()+
  ggtitle("Insulina sérica y condición de diabetes según IMC")+
  ylab("Insulina (mu U/ml)")+
  xlab("IMC")+
  facet_wrap(~diabetes)+
  theme_bw()
```
]
.pull-right[
```{r}
p <- datos %>%
  mutate(CIMC=cut(mass,breaks = c(10,18.5,25,30,35,Inf),
                  labels = c("Delgadez","Normalidad",
                             "Sobrepeso","Obesidad","O Extrema"))) %>%
  ggplot(aes(y=insulin,x=CIMC,fill=CIMC))+
  geom_boxplot()+coord_flip()+
  ggtitle("Insulina sérica y condición de\ndiabetes según IMC")+
  ylab("Insulina (mu U/ml)")+xlab("")+labs(fill="")+
  theme(legend.position = "bottom")+
  facet_wrap(~diabetes)+theme_bw()
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=110,b=80)) %>%
              layout_ggplotly(y=0.25),
            height = 500)
```
]
---
# Gráficos compuestos

.pull-left[
```{r,echo=TRUE,eval=FALSE}
datos %>%
  mutate(CIMC=cut(mass,breaks = c(10,18.5,25,30,35,Inf),
                  labels = c("Delgadez","Normalidad",
                             "Sobrepeso","Obesidad","O Extrema"))) %>%
  na.omit %>%
  ggplot(aes(y=insulin,x=diabetes,fill=diabetes))+
  geom_boxplot()+
  ggtitle("Insulina sérica y condición de diabetes según IMC")+
  ylab("Insulina (mu U/ml)")+xlab("Diabetes")+
  facet_wrap(~CIMC)+theme_bw()
```
]
.pull-right[
```{r}
p <- datos %>%
  mutate(CIMC=cut(mass,breaks = c(10,18.5,25,30,35,Inf),
                  labels = c("Delgadez","Normalidad",
                             "Sobrepeso","Obesidad","O Extrema"))) %>%
  na.omit %>%
  ggplot(aes(y=insulin,x=diabetes,fill=diabetes))+
  geom_boxplot()+
  ggtitle("Insulina sérica y condición de diabetes según IMC")+
  ylab("Insulina (mu U/ml)")+xlab("Diabetes")+
  theme(legend.position = "bottom")+labs(fill="")+
  facet_wrap(~CIMC)+theme_bw()
frameWidget(ggplotly(p) %>%
              config(displayModeBar = F) %>%
              layout(margin=list(t=100,l=80),
                     legend = list(orientation = "h",
                                   y=-0.2,x=0.35)) %>%
              layout_ggplotly(),
            height = 500)
```
]